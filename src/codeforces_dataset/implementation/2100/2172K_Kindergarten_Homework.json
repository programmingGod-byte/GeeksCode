{
    "contestId": 2172,
    "index": "K",
    "title": "K. Kindergarten Homework",
    "statement": "Kenny is a kindergarten teacher who is teaching his students about math. To help them learn, he wants to give them homework in an enjoyable and non-annoying format â€“ Number Search.\nA Number Search puzzle is similar to a Word Search puzzle, but instead of words, it's about finding math expressions. An instance of the puzzle consists of two parts: a grid with $$$n$$$ rows and $$$m$$$ columns, and a list $$$a_1, a_2, \\dots, a_q$$$ of $$$q$$$ target numbers to search for. Each cell in the grid contains a digit from\n1\nto\n9\n, a plus sign\n+\n, or a multiplication sign\n*\n.\nAn expression can be formed by joining one or more consecutive characters along the same row, column, or diagonal, in a straight line (in either direction). Each expression can be defined by its starting cell and ending cell. Two expressions are considered different if they start or end at different cells, even if they contain the exact same characters.\nA valid expression must be of the form $$$$$$ num \\quad op \\quad num \\quad op \\ \\dots \\ op \\quad num $$$$$$ where each $$$num$$$ is a sequence of one or more digits, and each $$$op$$$ is either\n+\nor\n*\n. For example, \"\n123\n\" and \"\n1+2*3+45\n\" are valid expressions, while \"\n+123\n\" and \"\n2**5\n\" are not. The value of an expression is the result of evaluating it following typical arithmetic rules.\nThe goal of the puzzle is to count, for each number $$$a_i$$$, how many different valid expressions in the grid evaluate to $$$a_i$$$.\nTo demonstrate the rules, consider the following completed Number Search puzzle:\nLet's denote the cell at row $$$r$$$ and column $$$c$$$ as $$$(r,c)$$$.\nThe answer for $$$67$$$ is $$$2$$$, as there are two expressions \"\n67\n\" that start at $$$(1, 4)$$$. Although both expressions contain the same characters, they are considered different because they end at different positions.\nThe answer for $$$420$$$ is $$$0$$$, as no expressions in the grid evaluate to $$$420$$$.\nThe answer for $$$3$$$ is $$$4$$$:\nThe expression \"\n3\n\" appears twice, at $$$(1,7)$$$ and $$$(9,5)$$$.\nThe expression \"\n1+2\n\" appears from $$$(6,2)$$$ to $$$(8,2)$$$.\nThe expression \"\n2+1\n\" appears from $$$(8,2)$$$ to $$$(6,2)$$$. Even though they share the same set of cells, the two expressions are considered different because they start at different positions.\nThe answer for $$$727$$$ is $$$3$$$:\nThe expression \"\n7+16*45\n\" appears from $$$(2,1)$$$ to $$$(8,7)$$$. Note that multiplication is performed before addition.\nThe expression \"\n727\n\" appears from $$$(3,5)$$$ to $$$(3,7)$$$, and from $$$(3,7)$$$ to $$$(3,5)$$$. Even though they share the same set of cells and contain the same characters, they are considered different because they start at different positions.\nKenny can't wait to see children enjoy solving interesting Number Search puzzles. But before giving them a puzzle, he needs to have the answers ready. Please help him calculate the answers for each puzzle he has prepared.",
    "inputSpecification": "Input\nThe first line contains three integers $$$n$$$, $$$m$$$, and $$$q$$$, representing the number of rows, the number of columns, and the number of target numbers, respectively.\nEach of the following $$$n$$$ lines contains a string of $$$m$$$ characters, representing the grid.\nThe $$$i$$$-th of the following $$$q$$$ lines contains an integer $$$a_i$$$, representing the $$$i$$$-th target number.\n$$$1 \\leq n, m \\leq 1000$$$\n$$$1 \\leq n \\times m \\leq 3 \\times 10^4$$$\n$$$1 \\leq q \\leq 10^5$$$\nThe grid contains only the characters in \"\n123456789+*\n\".\n$$$1 \\leq a_i \\leq 10^6$$$\nAll $$$a_i$$$ are distinct.",
    "outputSpecification": "Output\nPrint $$$q$$$ lines. The $$$i$$$-th line contains an integer, representing the answer for $$$a_i$$$.",
    "note": "",
    "tags": [
        "implementation",
        "strings"
    ],
    "rating": 2100
}